{% extends 'public/base_public.html' %}
{% load static %}
{% block title %}@{{ card.nickname }}{% endblock %}
{% block content %}
<main class="card-viewer">
  <section class="header">
    <div class="header-left">
      {% if card.avatar_w128 %}
        <img class="avatar" src="{% url 'media:image_public' path=card.avatar_w128.name %}" alt="Avatar de {{ card.title }}" width="96" height="96" />
      {% endif %}
      <div class="title-wrap">
        <h1 class="title">{{ card.title }}</h1>
        <div class="nickname">@{{ card.nickname }}</div>
      </div>
    </div>
    <div class="header-right">
      {% with addrs=card.addresses.all %}
      {% if addrs|length %}
      <details class="addr-dropdown">
        <summary class="btn" aria-label="Endereços">
          <svg aria-hidden="true" width="18" height="18"><use href="{% static 'ui/icons.svg' %}#icon-location"></use></svg>
          <span class="sr-only">Endereços</span>
        </summary>
        <ul class="addr-menu">
          {% for a in addrs %}
          {% with query=a.logradouro|default:''|add:', '|add:a.numero|default:''|add:' - '|add:a.bairro|default:''|add:', '|add:a.cidade|default:''|add:' - '|add:a.uf|default:''|add:', '|add:a.cep|default:''|add:' Brasil' %}
          <li>
            <a target="_blank" rel="noopener"
               href="https://www.google.com/maps/search/?api=1&query={{ query|urlencode }}">
              {{ a.label|default:"Endereço" }}
            </a>
          </li>
          {% endwith %}
          {% endfor %}
        </ul>
      </details>
      {% endif %}
      {% endwith %}
      <!-- Theme toggle next to addresses -->
      <button class="btn" aria-label="Alternar tema" title="Alternar tema">
        <svg aria-hidden="true" width="18" height="18"><use href="{% static 'ui/icons.svg' %}#icon-moon"></use></svg>
      </button>
    </div>
  </section>

  {% if card.description %}
  <section class="desc"><p>{{ card.description }}</p></section>
  {% endif %}

{% with links_len=links|length gallery_len=gallery|length services_len=services|length %}
  {% if links_len or gallery_len or services_len or about_enabled %}
  <section class="tabs">
    <div class="tablist" role="tablist">
      {% for key in tab_order %}
        {% if key == 'links' and links_len %}
          <button role="tab" aria-controls="panel-links" class="tab  primary {% if forloop.first %}is-active{% endif %}"
                  hx-get="{% url 'tabs_links' card.nickname %}" hx-target="#panel-links" hx-swap="outerHTML">Links</button>
        {% elif key == 'gallery' and gallery_len %}
          <button role="tab" aria-controls="panel-gallery" class="tab  primary {% if forloop.first %}is-active{% endif %}"
                  hx-get="{% url 'tabs_gallery' card.nickname %}" hx-target="#panel-gallery" hx-swap="outerHTML">Galeria</button>
        {% elif key == 'services' and services_len %}
          <button role="tab" aria-controls="panel-services" class="tab  primary {% if forloop.first %}is-active{% endif %}"
                  hx-get="{% url 'tabs_services' card.nickname %}" hx-target="#panel-services" hx-swap="outerHTML">Serviços</button>
        {% elif key == 'about' and about_enabled %}
          <button role="tab" aria-controls="panel-about" class="tab  primary {% if forloop.first %}is-active{% endif %}">Sobre</button>
        {% endif %}
      {% endfor %}
    </div>

    {# Panels in the same ordered, first visible #}
    <div>
      {% for key in tab_order %}
        {% if key == 'links' and links_len %}
          <div id="panel-links" role="tabpanel" class="panel" {% if not forloop.first %}hidden{% endif %}>
            {% include 'public/tabs_links.html' %}
          </div>
        {% elif key == 'gallery' and gallery_len %}
          <div id="panel-gallery" role="tabpanel" class="panel" {% if not forloop.first %}hidden{% endif %}>
            {% include 'public/tabs_gallery.html' %}
          </div>
        {% elif key == 'services' and services_len %}
          <div id="panel-services" role="tabpanel" class="panel" {% if not forloop.first %}hidden{% endif %}>
            {% include 'public/tabs_services.html' %}
          </div>
        {% elif key == 'about' and about_enabled %}
          <div id="panel-about" role="tabpanel" class="panel" {% if not forloop.first %}hidden{% endif %}>
            {% include 'public/tabs_about.html' %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </section>
  {% endif %}
  {% endwith %}

  {% if socials|length %}
  <nav class="socials" aria-label="Redes sociais">
    {% for s in socials %}
      <a class="social" href="{{ s.url }}" target="_blank" rel="noopener">
        <svg aria-hidden="true" width="18" height="18"><use href="{% static 'ui/icons.svg' %}#icon-{{ s.platform }}"></use></svg>
        <span class="sr-only">{{ s.platform }}</span>
      </a>
    {% endfor %}
  </nav>
  {% endif %}

  <aside id="slideover" aria-live="polite"></aside>
</main>
{% endblock %}
