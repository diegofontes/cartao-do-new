{% extends 'public/base_public.html' %}
{% load static %}
{% block title %}Encontrar cards próximos{% endblock %}
{% block content %}
<section class="search-page">
  <header class="search-page__header">
    <h1>Encontrar próximos a mim</h1>
    <p>Use sua localização ou informe um CEP para localizar cards publicados com perfil de busca ativo.</p>
    <div class="search-page__actions">
      <button type="button" class="btn primary" id="geo-btn">Usar minha localização</button>
      <form id="cep-form" class="row" style="gap:var(--space-2)">
        <label class="field" style="margin:0">
          <span>CEP (stub)</span>
          <input type="text" id="cep-public" placeholder="00000-000" maxlength="9" />
        </label>
        <button type="submit" class="btn">Buscar CEP</button>
      </form>
      <div class="muted" id="cep-public-feedback" role="status" aria-live="polite"></div>
    </div>
  </header>

  <form id="search-form" class="search-form" hx-get="{% url 'search:cards_nearby' %}" hx-target="#search-results" hx-indicator="#search-loading" hx-encoding="multipart/form-data">
    <div class="grid" style="gap:var(--space-3);grid-template-columns:repeat(auto-fit,minmax(180px,1fr))">
      <label class="field">
        <span>Latitude</span>
        <input type="number" step="0.0000001" name="lat" required />
      </label>
      <label class="field">
        <span>Longitude</span>
        <input type="number" step="0.0000001" name="lng" required />
      </label>
      <label class="field">
        <span>Raio (km)</span>
        <input type="number" step="0.5" min="0.5" max="50" name="radius_km" value="{{ default_radius|default:10 }}" />
      </label>
      <label class="field">
        <span>Categoria</span>
        <select name="category">
          <option value="">Todas</option>
          <option value="estetica_beleza">Estética e Beleza</option>
          <option value="manutencao">Manutenção</option>
          <option value="transporte">Transporte</option>
          <option value="delivery">Delivery</option>
          <option value="consultoria">Consultoria (contábil/advogado)</option>
        </select>
      </label>
      <label class="field">
        <span>Modo</span>
        <select name="mode">
          <option value="">Todos</option>
          <option value="appointment">Agendamentos</option>
          <option value="delivery">Delivery</option>
        </select>
      </label>
    </div>
    <div class="row" style="justify-content:flex-end;gap:var(--space-2)">
      <button type="submit" class="btn">Buscar</button>
    </div>
  </form>

  <div id="search-loading" class="spinner" role="status" aria-live="polite">Buscando…</div>
  <div id="search-results" class="search-results-container" aria-live="polite"></div>
</section>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'public/search.js' %}" defer></script>
<script>
  window.SEARCH_ENDPOINTS = {
    geocode: "{% url 'search:geocode_stub' %}",
  };
</script>
{% endblock %}
