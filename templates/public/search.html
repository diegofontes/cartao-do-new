{% extends 'public/base_public.html' %}
{% load static %}
{% block title %}Buscar cards publicados{% endblock %}
{% block content %}
<section class="search-page search-page--landing">
  <button class="icon-btn search-theme-toggle" id="theme-toggle" aria-label="Alternar tema" aria-pressed="false" title="Alternar tema">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true"><path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364-1.414-1.414M7.05 7.05 5.636 5.636m12.728 0-1.414 1.414M7.05 16.95l-1.414 1.414"/></svg>
  </button>
  <div class="search-hero">
    <div class="search-logo" role="presentation">
      <img src="{% static 'img/logo-cap-v1.png' %}"
           data-logo-dark="{% static 'img/logo-cap-v1.png' %}"
           data-logo-light="{% static 'img/logo-cap-v1-dark.png' %}"
           alt="Secunix"
           width="264"
           height="auto" />
    </div>

    <form id="search-form"
          class="search-form search-form--bar"
          hx-post="{% url 'search:geocode' %}"
          hx-target="#results"
          hx-swap="outerHTML"
          hx-indicator="#results-loading"
          data-results-url="{% url 'search:results' %}"
          data-default-radius="{{ default_radius|default:10 }}">
      {% csrf_token %}
      <input type="hidden" name="state" value="SP">

      <div class="search-bar" role="group" aria-label="Buscar cards publicados">
        <div class="search-bar__segment search-bar__segment--address">
          <label class="visually-hidden" for="search-address">Endere√ßo</label>
          <input id="search-address"
                 name="address"
                 class="search-input"
                 type="text"
                 placeholder="Informe um endere√ßo em S√£o Paulo"
                 autocomplete="off"
                 aria-describedby="address-hint">
          <button type="button"
                  class="search-bar__clear"
                   id="btn-geoloc">
            üìç
          </button>
          <button type="button"
                  class="search-bar__clear"
                  data-action="clear-address"
                  aria-label="Limpar endere√ßo">
            &times;
          </button>
        </div>
        <span class="search-bar__divider" aria-hidden="true"></span>
        <div class="search-bar__segment search-bar__segment--radius">
          <label class="visually-hidden" for="radius-input">Raio de busca</label>
          {% with current_radius=default_radius|default:10|stringformat:"s" %}
            <select id="radius-input" name="radius_km" class="search-select" aria-label="Raio em quil√¥metros">
              {% for km in radius_options %}
                {% with km_str=km|stringformat:"s" %}
                  <option value="{{ km_str }}" {% if km_str == current_radius %}selected{% endif %}>+ {{ km_str }} km</option>
                {% endwith %}
              {% endfor %}
            </select>
          {% endwith %}
        </div>
        <button type="submit" class="btn primary search-bar__submit">
          <span aria-hidden="true">üîç</span>
          <span>Procurar</span>
        </button>
      </div>
      <div id="geo-feedback" class="search-feedback" role="status" aria-live="polite">
        Ex.: "Av. Paulista, 1000" (somente endere√ßos em SP).
      </div>
      <!-- <p id="address-hint" class="search-hint muted">
      </p> -->

      <div class="search-actions" role="navigation" aria-label="A√ß√µes r√°pidas">
        <details class="search-filter">
          <summary>Filtros</summary>
          <fieldset class="switch-group">
            <legend class="filter-field">Categoria</legend>
            {% for option in categories %}
              <label class="switch">
                <input type="radio"
                       name="category"
                       value="{{ option.value }}"
                       {% if not option.value %}checked{% endif %}>
                <span class="switch__body">
                  <span class="switch__track" aria-hidden="true"></span>
                  <span class="switch__label">{{ option.label }}</span>
                </span>
              </label>
            {% endfor %}
          </fieldset>
        </details>
      </div>
    </form>
  </div>

  <div class="results-shell" id="results-shell">
    <div id="results" class="search-results card" aria-live="polite">
      <p class="muted">Use um endere√ßo ou sua geolocaliza√ß√£o para iniciar a busca.</p>
    </div>
    <div id="results-loading" class="results-loading htmx-indicator" aria-hidden="true">
      <div class="card skeleton" style="height:112px"></div>
      <div class="card skeleton" style="height:112px"></div>
      <div class="card skeleton" style="height:112px"></div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'public/search_mode.js' %}" defer></script>
{% endblock %}
